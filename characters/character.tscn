[gd_scene load_steps=10 format=2]

[ext_resource path="res://characters/character.gd" type="Script" id=1]
[ext_resource path="res://characters/stats.gd" type="Script" id=2]

[sub_resource type="CapsuleMesh" id=1]

[sub_resource type="SpatialMaterial" id=2]
albedo_color = Color( 1, 0.466667, 0.466667, 1 )
roughness = 0.31

[sub_resource type="CapsuleShape" id=3]
radius = 1.00469
height = 1.74365

[sub_resource type="BoxShape" id=4]

[sub_resource type="CubeMesh" id=5]

[sub_resource type="Shader" id=6]
code = "shader_type spatial;

uniform float percentage = 0.5;
uniform float angle = 0.0;

void vertex()
{
	//float angle = cosh(dot(dir.xz, BINORMAL.xz) / length(BINORMAL.xz) * length(dir.xz));
	float old_x = VERTEX.x;
	VERTEX.x = 1.0-2.0*percentage;
	if(VERTEX.x < old_x)
		VERTEX.x = old_x;
	VERTEX = (inverse(WORLD_MATRIX) * mat4(vec4(cos(angle), 0.0, sin(angle), 0.0),
			vec4(0.0, 1.0, 0.0, 0.0),
			vec4(-sin(angle), 0.0, cos(angle), 0.0),
			vec4(0.0, 0.0, 0.0, 1.0)) * WORLD_MATRIX * vec4(VERTEX, 1.0)).xyz;
	//COLOR = vec4(1.0, 0.0, 0.0, 1.0);
}

void fragment()
{
	ALBEDO = vec3(1.0, 0.0, 0.0);
	if(percentage <= 0.0)
		ALPHA = 0.0;
}"

[sub_resource type="ShaderMaterial" id=7]
shader = SubResource( 6 )
shader_param/percentage = 0.0
shader_param/angle = 0.0

[node name="character_body" type="KinematicBody" groups=[
"characters",
]]
transform = Transform( 0.5, 0, 0, 0, 0.5, 0, 0, 0, 0.5, 0, 0.94, 0 )
script = ExtResource( 1 )

[node name="character_mesh" type="CSGMesh" parent="."]
transform = Transform( 1, 0, 0, 0, -4.37114e-08, 1.25, 0, -1, -5.46392e-08, 0, 0, 0 )
mesh = SubResource( 1 )
material = SubResource( 2 )

[node name="character_collision" type="CollisionShape" parent="."]
transform = Transform( 1, 0, 0, 0, -4.37114e-08, 1, 0, -1, -4.37114e-08, 0, 0, 0 )
shape = SubResource( 3 )

[node name="interact_area" type="Area" parent="."]
transform = Transform( 0.5, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -1 )

[node name="collision" type="CollisionShape" parent="interact_area"]
shape = SubResource( 4 )

[node name="stats" type="Node" parent="."]
script = ExtResource( 2 )

[node name="inventory" type="Node" parent="stats"]

[node name="health_bar" type="CSGMesh" parent="."]
transform = Transform( 1.25, 0, 0, 0, 0.25, 0, 0, 0, 0.1, 0, 2.4, 0 )
mesh = SubResource( 5 )
material = SubResource( 7 )

[connection signal="body_entered" from="interact_area" to="." method="_on_interact_area_body_entered"]
[connection signal="body_exited" from="interact_area" to="." method="_on_interact_area_body_exited"]
